# Архитектурное решение по трейсингу

## Системы, которые следует покрыть трейсингом
- MES и CRM, системы соединены шиной, можно увидеть как путь от подверждения заказа и публикации на расчет, так и рапроса на расчет из публичного API
- Internet shop для отслеживания запросов от момента создания до загрузки 3d-модели в s3 хранилище


## Мотивация
Трейсинг поможет быстро находить причины, например, медленной работы сервиса. Вместо просмотра всей цепочки вызовов, которую нужно к тому же раскрутить, разработчик может посмотреть, сколько, где и с какими параметрами прошёл вызов. У трейсинга как средства устранения неполадок есть дополнительные преимущества, поскольку любое исключение или ошибка обычно фиксируется вместе со всем контекстом запроса.


## Предлагаемое решение
- Установка и интеграция OpenTelemetry SDK в приложения
- Настройка экспорта трейсов в Grafana Tempo через OLTP
- Настройка Tempo и интеграция с Grafana
- Создание дашбордов для визуализации трейсов

[Диаграмма контейнеров с компонентами для трейсинга](jewerly_c4_model.trace.png)


## Компромиссы
Доработка потребует времени и ресурсов как разработчиков, так и devops-инженера. Сейчас на каждую систему приходится по одному бэкенд разработчику. В случае наличия более приоритетных бизнес-задач интеграция трейсов может занять больше времени.


## Аспекты безопасности
- Внедрение, если еще нет, ролевой модели доступа (RBAC), чтобы ограничить доступ к данным трейсов и дашбордам.
- Настройка аутентификации для доступа к Tempo и Alloy.
- Ограничение доступа к API Alloy только доверенным IP-адресам или сетям.
